---
inspecode:

  global:
    ignore:
      - "vendor/"
    runtime:
      go: 1.14          # Golang >= 1.14 (README.md#b-from-source)

  experimental:
    env:
      GO111MODULE: on   # (README.md#b-from-source)
      ## Set the Goby project's exact root path $GOBY_ROOT manually

  tasks:

    - name: dockerfilelint
      type: docker-build
      dockerfile: ".rocro/dflint/Dockerfile"
      options:
        --build-arg:
          OUTDIR=/.reports
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/dockerfilelint.json"
          - stage: linter-stage
            path: "/.reports/dockerfilelint.sarif"
      reports:
        - stage: linter-stage
          path: "/.reports/dockerfilelint.sarif"
      thresholds: {num-issues: 1}

    - name: hadolint
      type: docker-build
      dockerfile: ".rocro/hadolint/Dockerfile"
      options:
        --build-arg:
          OUTDIR=/.reports
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/hadolint.json"
          - stage: linter-stage
            path: "/.reports/hadolint.sarif"
      reports:
        - stage: linter-stage
          path: "/.reports/hadolint.sarif"
      thresholds: {num-issues: 11}

    - name: yamllint
      type: docker-build
      dockerfile: ".rocro/yamllint/Dockerfile"
      options:
        --build-arg:
          OUTDIR=/.reports
      artifacts:
        uploads:
          - stage: linter-stage
            path: "/.reports/yamllint.issues"
          - stage: linter-stage
            path: "/.reports/yamllint.sarif"
      reports:
        - stage: linter-stage
          path: "/.reports/yamllint.sarif"
          format:
            type: SARIF
      thresholds: {num-issues: 56}

  tools:

    cpd:
      options: [--skip-lexical-errors]
      thresholds: {num-issues: 28}

    errcheck:
      thresholds: {num-issues: 67}

    # fortify:
    #   thresholds: {num-issues: 999}

    fossology:
      thresholds: {num-issues: 2}

    go-test:
      thresholds: {num-issues: 1}

    go-vet:
      thresholds: {num-issues: 0}

    gofmt:
      auto-fix: true
      thresholds: {num-issues: 1}

    goimports:
      auto-fix: true
      thresholds: {num-issues: 1}

    golint:
      thresholds: {num-issues: 1}

    gosec:
      thresholds: {num-issues: 62}
  
    grep:
      thresholds: {num-issues: 39}

    ineffassign:
      thresholds: {num-issues: 0}

    jscpd:
      thresholds: {num-issues: 195}
  
    misspell:
      auto-fix: true
      thresholds: {num-issues: 0}

    staticcheck:
      thresholds: {num-issues: 58}

    unused:
      ignore:
        - "vendor/"
        - "**/*_test.go"
      options: [--single-occurrence, --all-likelihoods]
      thresholds: {num-issues: 7}
